## Cài đăt Kubernetes 

### 1. Môi trường
- Ubuntu 16.04 - 64 bit (3 node: 01 Node Master, 02 node worker)
- Docker version
- Kubernetes version

### 2. Mô hình & IP Planning

#### 2.1. Mô hình: 

![K8S-topology](../../images/K8S-topology.png)

- File topology online được cung cấp ở [link  này](https://www.draw.io/#G1NmTeK-k590hew0GikQcl_TNiwO1nDjxK)

#### 2.2. IP Planning:

![ip-planning](../../images/ip-planning.png)

- Lưu ý: Mặc dù trong bảng trên ta có 03 NICs cho mỗi máy nhưng trong các bước hướng dẫn này ta chỉ cần sử dụng interface có dải `172.16.68.0/24`. Các dải còn lại là do hạ tầng của tôi và tôi chuẩn bị sẵn để cho các mục tiêu khác. Do vậy để làm theo LAB này bạn chỉ mỗi máy có 01 NIC là được. Hãy thay lại IP cho phù hợp với môi trường của bạn nhé.
 
### 3. Bước chuẩn bị

Đặt hostname, IP cho tất cả các node theo IP Planning
- SSH với tài khoản `root` và thực hiện.

#### 3.1. Đặt hostname và ip cho node `master`
- Thực hiện update và cài các gói bổ trợ cho OS.

  ```sh
  apt-get update -y
  apt-get install -y vim curl wget 
  ```

- Đặt ip cho node master bằng cách sửa file `/etc/network/interfaces` giống như nội dung dưới.

  ```sh
  # This file describes the network interfaces available on your system
  # and how to activate them. For more information, see interfaces(5).

  source /etc/network/interfaces.d/*

  # The loopback network interface
  auto lo
  iface lo inet loopback

  # The primary network interface
  auto ens4
  iface ens4 inet static
  address 172.16.68.130
  netmask 255.255.255.0
  gateway 172.16.68.1
  dns-nameservers 8.8.8.8
  ```

- Đặt hostname cho máy `master` bằng cách sửa nội dung các file
  - Nội dung file `/etc/hosts` như dưới
    ```sh
    127.0.0.1       localhost master
    172.16.68.130       master
    172.16.68.131       node1
    172.16.68.132       node2
    ```
    
  - File `/etc/hostname` được sửa bằng lệnh dưới.
    ```sh
    echo master > /etc/hostname
    ```
    
- Khởi động lại node master
  ```sh
  init 6
  ```

#### 3.1. Đặt hostname và ip cho node `node1`
- Thực hiện update và cài các gói bổ trợ cho OS.

  ```sh
  apt-get update -y
  apt-get install -y vim curl wget 
  ```

- Đặt ip cho node `node1` bằng cách sửa file `/etc/network/interfaces` giống như nội dung dưới.

  ```sh
  # This file describes the network interfaces available on your system
  # and how to activate them. For more information, see interfaces(5).

  source /etc/network/interfaces.d/*

  # The loopback network interface
  auto lo
  iface lo inet loopback

  # The primary network interface
  auto ens4
  iface ens4 inet static
  address 172.16.68.131
  netmask 255.255.255.0
  gateway 172.16.68.1
  dns-nameservers 8.8.8.8
  ```

- Đặt hostname cho node `node1` bằng cách sửa nội dung các file
  - Nội dung file `/etc/hosts` như dưới
    ```sh
    127.0.0.1       localhost node1
    172.16.68.130       master
    172.16.68.131       node1
    172.16.68.132       node2
    ```
    
  - File `/etc/hostname` được sửa bằng lệnh dưới.
    ```sh
    echo node1 > /etc/hostname
    ```
    
- Khởi động lại `node1`
  ```sh
  init 6
  ```

#### 3.2. Đặt hostname và ip cho node `node2`
- Thực hiện update và cài các gói bổ trợ cho OS.

  ```sh
  apt-get update -y
  apt-get install -y vim curl wget 
  ```

- Đặt ip cho node `node2` bằng cách sửa file `/etc/network/interfaces` giống như nội dung dưới.

  ```sh
  # This file describes the network interfaces available on your system
  # and how to activate them. For more information, see interfaces(5).

  source /etc/network/interfaces.d/*

  # The loopback network interface
  auto lo
  iface lo inet loopback

  # The primary network interface
  auto ens4
  iface ens4 inet static
  address 172.16.68.132
  netmask 255.255.255.0
  gateway 172.16.68.1
  dns-nameservers 8.8.8.8
  ```

- Đặt hostname cho node `node2` bằng cách sửa nội dung các file
  - Nội dung file `/etc/hosts` như dưới
    ```sh
    127.0.0.1       localhost node2
    172.16.68.130       master
    172.16.68.131       node1
    172.16.68.132       node2
    ```
    
  - File `/etc/hostname` được sửa bằng lệnh dưới.
    ```sh
    echo node2 > /etc/hostname
    ```
    
- Khởi động lại `node2`
  ```sh
  init 6
  ```
